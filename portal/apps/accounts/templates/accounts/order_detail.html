{% extends "base.html" %}
{% load i18n %}

{% block content %}
<main class="container order-detail-container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="{% url 'accounts:orders-list' %}">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            {% trans "Mes commandes" %}
        </a>
    </nav>

    <!-- Hero -->
    <div class="order-hero">
        <div class="order-hero-left">
            <h1 class="order-title">{% trans "Commande" %} #{{ order.number }}</h1>
            <span class="order-status-badge badge-{{ order.state }}">
                {{ order.state_label }}
            </span>
        </div>
        <div class="order-hero-actions">
            <!-- Future actions like Download PDF -->
            <button class="btn btn-outline" disabled title="Bientôt disponible">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                {% trans "Télécharger le bon de commande" %}
            </button>
        </div>
    </div>

    <!-- Métadonnées -->
    <div class="order-meta-card">
        <div class="order-meta-grid">
            <div class="meta-item">
                <span class="meta-label">{% trans "Référence" %}</span>
                <span class="meta-value">{{ order.reference|default:"—" }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">{% trans "Créée le" %}</span>
                <span class="meta-value {% if not order.create_date %}empty{% endif %}">
                    {{ order.create_date|date:"d/m/Y"|default:_("Non définie") }}
                </span>
            </div>
            <div class="meta-item">
                <span class="meta-label">{% trans "Livraison estimée" %}</span>
                <span class="meta-value {% if not order.shipping_date %}empty{% endif %}">
                    {{ order.shipping_date|date:"d/m/Y"|default:_("À confirmer") }}
                </span>
            </div>
            <div class="meta-item">
                <span class="meta-label">{% trans "Sous-total (avant taxes)" %}</span>
                <span class="meta-value">
                    {{ order.untaxed_amount|default:"—" }}
                    {% if order.currency_label %}
                    {{ order.currency_label }}
                    {% endif %}
                </span>
            </div>
            <div class="meta-item">
                <span class="meta-label">{% trans "Total (taxes incluses)" %}</span>
                <span class="meta-value">
                    {{ order.total_amount|default:"—" }}
                    {% if order.currency_label %}
                    {{ order.currency_label }}
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Lignes -->
    <div class="order-lines-card">
        <h2>{% trans "Produits commandés" %}</h2>
        {% if order.lines %}
        <table class="order-table">
            <thead>
                <tr>
                    <th>{% trans "Produit" %}</th>
                    <th>{% trans "Qté" %}</th>
                    <th>{% trans "Prix unit." %}</th>
                    <th>{% trans "Total ligne" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for line in order.lines %}
                <tr>
                    <td>
                        <div class="product-name">{{ line.description|default:line.product }}</div>
                        {% if line.note %}
                        <div class="product-description">{{ line.note }}</div>
                        {% endif %}
                    </td>
                    <td>{{ line.quantity }}{% if line.unit %} {{ line.unit }}{% endif %}</td>
                    <td>
                        {% if line.unit_price %}
                        {{ line.unit_price }}
                        {% if order.currency_label %}
                        {{ order.currency_label }}
                        {% endif %}
                        {% else %}
                        <span class="empty">—</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if line.total %}
                        {{ line.total }}
                        {% if order.currency_label %}
                        {{ order.currency_label }}
                        {% endif %}
                        {% else %}
                        <span class="empty">—</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3" class="total-label">{% trans "Total général" %}</td>
                    <td>
                        {{ order.total_amount|default:"—" }}
                        {% if order.currency_label %}
                        {{ order.currency_label }}
                        {% endif %}
                    </td>
                </tr>
            </tfoot>
        </table>
        {% else %}
        <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-package">
                <line x1="16.5" y1="9.4" x2="7.5" y2="4.21" />
                <path
                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                <line x1="12" y1="22.08" x2="12" y2="12" />
            </svg>
            <h3>{% trans "Aucun produit dans cette commande" %}</h3>
            <p>{% trans "Ajoutez des produits pour finaliser votre commande." %}</p>
        </div>
        {% endif %}
    </div>
</main>
{% endblock %}